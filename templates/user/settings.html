{% extends "user/base.html" %}

{% block title %}Settings - PujaPath{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold gradient-text">Settings</h1>
    <p class="text-gray-600">Manage your account preferences</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Settings Menu -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-lg p-4">
            <h2 class="text-lg font-bold mb-4">Settings Menu</h2>
            <nav class="space-y-2">
                <button onclick="showSection('account')"
                    class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition active">
                    <i class="fas fa-user-cog mr-3"></i>Account Settings
                </button>
                <button onclick="showSection('notifications')"
                    class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition">
                    <i class="fas fa-bell mr-3"></i>Notifications
                </button>
                <button onclick="showSection('privacy')"
                    class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition">
                    <i class="fas fa-shield-alt mr-3"></i>Privacy & Security
                </button>
                <button onclick="showSection('preferences')"
                    class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 hover:text-purple-600 transition">
                    <i class="fas fa-sliders-h mr-3"></i>Preferences
                </button>
            </nav>
        </div>
    </div>

    <!-- Settings Content -->
    <div class="lg:col-span-2">
        <!-- Account Settings -->
        <div id="account-section" class="settings-section">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold mb-6">Account Information</h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Username</label>
                        <input type="text" id="settings-username" disabled
                            class="w-full px-4 py-3 border rounded-lg bg-gray-100">
                        <p class="text-xs text-gray-500 mt-1">Username cannot be changed</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input type="email" id="settings-email" disabled
                            class="w-full px-4 py-3 border rounded-lg bg-gray-100">
                        <p class="text-xs text-gray-500 mt-1">Contact support to change email</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 mb-2">Member Since</label>
                        <input type="text" id="settings-member-since" disabled
                            class="w-full px-4 py-3 border rounded-lg bg-gray-100">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6 text-red-600">Danger Zone</h2>

                <div class="border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold mb-2">Delete Account</h3>
                    <p class="text-sm text-gray-600 mb-4">Once you delete your account, there is no going back. Please
                        be certain.</p>
                    <button onclick="deleteAccount()"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                        <i class="fas fa-trash mr-2"></i>Delete My Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Settings -->
        <div id="notifications-section" class="settings-section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">Notification Preferences</h2>

                <div class="space-y-4">
                    <div class="flex items-center justify-between py-3 border-b">
                        <div>
                            <h3 class="font-semibold">Email Notifications</h3>
                            <p class="text-sm text-gray-600">Receive updates about your orders and bookings</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="email-notifications" class="sr-only peer" checked>
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600">
                            </div>
                        </label>
                    </div>

                    <div class="flex items-center justify-between py-3 border-b">
                        <div>
                            <h3 class="font-semibold">SMS Notifications</h3>
                            <p class="text-sm text-gray-600">Get text messages for important updates</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="sms-notifications" class="sr-only peer">
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600">
                            </div>
                        </label>
                    </div>

                    <div class="flex items-center justify-between py-3 border-b">
                        <div>
                            <h3 class="font-semibold">Promotional Emails</h3>
                            <p class="text-sm text-gray-600">Receive special offers and discounts</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="promo-notifications" class="sr-only peer" checked>
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600">
                            </div>
                        </label>
                    </div>
                </div>

                <button onclick="saveNotificationSettings()"
                    class="mt-6 px-6 py-3 bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-lg hover:from-gray-900 hover:to-black transition">
                    Save Preferences
                </button>
            </div>
        </div>

        <!-- Privacy & Security Settings -->
        <div id="privacy-section" class="settings-section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">Privacy & Security</h2>

                <div class="space-y-6">
                    <div>
                        <h3 class="font-semibold mb-3">Two-Factor Authentication</h3>
                        <p class="text-sm text-gray-600 mb-4">Add an extra layer of security to your account</p>
                        <button
                            class="px-4 py-2 border border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 transition">
                            <i class="fas fa-shield-alt mr-2"></i>Enable 2FA
                        </button>
                    </div>

                    <div class="pt-6 border-t">
                        <h3 class="font-semibold mb-3">Login History</h3>
                        <p class="text-sm text-gray-600 mb-4">View your recent login activity</p>
                        <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                            <i class="fas fa-history mr-2"></i>View Login History
                        </button>
                    </div>

                    <div class="pt-6 border-t">
                        <h3 class="font-semibold mb-3">Data Privacy</h3>
                        <p class="text-sm text-gray-600 mb-4">Download or delete your personal data</p>
                        <div class="flex space-x-3">
                            <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                <i class="fas fa-download mr-2"></i>Download Data
                            </button>
                            <button
                                class="px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition">
                                <i class="fas fa-trash mr-2"></i>Delete Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preferences Settings -->
        <div id="preferences-section" class="settings-section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">Preferences</h2>

                <div class="space-y-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Language</label>
                        <select
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="en">English</option>
                            <option value="hi">हिन्दी (Hindi)</option>
                            <option value="mr">मराठी (Marathi)</option>
                            <option value="bn">বাংলা (Bengali)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-gray-700 mb-2">Time Zone</label>
                        <select
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="IST">India Standard Time (IST)</option>
                            <option value="UTC">UTC</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-gray-700 mb-2">Currency</label>
                        <select
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="INR">₹ Indian Rupee (INR)</option>
                            <option value="USD">$ US Dollar (USD)</option>
                        </select>
                    </div>
                </div>

                <button onclick="savePreferences()"
                    class="mt-6 px-6 py-3 bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-lg hover:from-gray-900 hover:to-black transition">
                    Save Preferences
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Load user data
    async function loadUserData() {
        const token = localStorage.getItem('token');
        const userData = localStorage.getItem('user');

        if (userData) {
            try {
                const user = JSON.parse(userData);
                document.getElementById('settings-username').value = user.username || '';
                document.getElementById('settings-email').value = user.email || '';
                document.getElementById('settings-member-since').value = user.created_at ?
                    new Date(user.created_at).toLocaleDateString() : '';
            } catch (e) {
                console.error('Error parsing user data:', e);
            }
        }
    }

    // Show section
    function showSection(sectionName) {
        // Hide all sections
        document.querySelectorAll('.settings-section').forEach(section => {
            section.classList.add('hidden');
        });

        // Remove active class from all nav buttons
        document.querySelectorAll('.settings-nav-btn').forEach(btn => {
            btn.classList.remove('active', 'bg-purple-50', 'text-purple-600');
        });

        // Show selected section
        document.getElementById(`${sectionName}-section`).classList.remove('hidden');

        // Add active class to clicked button
        event.target.classList.add('active', 'bg-purple-50', 'text-purple-600');
    }

    // Save notification settings
    function saveNotificationSettings() {
        const settings = {
            email: document.getElementById('email-notifications').checked,
            sms: document.getElementById('sms-notifications').checked,
            promo: document.getElementById('promo-notifications').checked
        };

        // Save to localStorage for now
        localStorage.setItem('notificationSettings', JSON.stringify(settings));
        alert('Notification preferences saved successfully!');
    }

    // Save preferences
    function savePreferences() {
        alert('Preferences saved successfully!');
    }

    // Delete account
    function deleteAccount() {
        const confirmed = confirm('Are you absolutely sure you want to delete your account? This action cannot be undone.');

        if (confirmed) {
            const doubleConfirm = confirm('This will permanently delete all your data, orders, and bookings. Type "DELETE" to confirm.');

            if (doubleConfirm) {
                alert('Account deletion request submitted. Our team will contact you within 24 hours.');
            }
        }
    }

    // Load user data on page load
    document.addEventListener('DOMContentLoaded', loadUserData);
</script>

<style>
    .gradient-text {
        color: #2d2d2d;
    }
</style>
{% endblock %}